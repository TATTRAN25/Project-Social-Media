{% extends 'base.html' %}

{% block body_block %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<div class="profile_container">
    {% if blocked_user.blocker == current_user and blocked_user.blocked == profile.user %}
        <h1>You have blocked this user</h1>
    {% elif blocked_user.blocked == current_user and blocked_user.blocker == profile.user %}
        <h1>You have been blocked by {{ blocked_user.blocker }}</h1>
    {% else %}
        <div class="profile_layout">
            <div class="profile_header">
                <div class="profile_cover_photo">
                    {% if profile.cover_photo %}
                        <img src="{{ profile.cover_photo.url }}" alt="Cover Photo" class="profile-cover-photo">
                    {% else %}
                        <div class="default-cover-photo">No cover photo uploaded.</div>
                    {% endif %}
                </div>
                <div class="profile_avatar">
                    {% if profile.avatar %}
                        <img src="{{ profile.avatar.url }}" alt="Avatar" class="profile-avatar">
                    {% else %}
                        <p>No avatar uploaded.</p>
                    {% endif %}
                </div>
            </div>
            <div class="profile_info">
                <h1>{{ profile.user.username }} Profile</h1>
                <div class="info_details">
                    <p><strong>Address:</strong> {{ profile.address }}</p>
                    <p><strong>Bio:</strong> {{ profile.bio }}</p>
                    <p><strong>Status:</strong> {{ profile.status }}</p>
                </div>
                <div class="profile_actions">
                    {% if profile.user == current_user %}
                        {% if profile.status == 'inactive' %}
                            <div class="alert alert-warning">
                                T√†i kho·∫£n ƒë√£ b·ªã t·∫°m ng∆∞ng ho·∫°t ƒë·ªông n√™n kh√¥ng th·ªÉ ch·ªânh s·ª≠a.
                            </div>
                        {% elif user.is_authenticated and user == profile.user %}
                            <a href="{% url 'SocialMedia:profile_update' profile.pk %}" class="btn btn-primary">Ch·ªânh s·ª≠a H·ªì S∆°</a>
                            <div class="change_password_action" style="margin-top: 20px;">
                                <a href="{% url 'SocialMedia:change_password' %}" class="btn btn-warning">Thay ƒë·ªïi M·∫≠t kh·∫©u</a>
                            </div>
                        {% endif %}
                    {% else %}
                        {% if follow.following == profile.user %}
                            <a href="{% url 'SocialMedia:unfollow_user' profile.user.id %}" class="btn btn-info">Unfollow</a>
                        {% else %}
                            <a href="{% url 'SocialMedia:follow_user' profile.user.id %}" class="btn btn-outline-info">Follow</a>
                        {% endif %}
                    {% endif %}
                    <a href="{% url 'SocialMedia:friends_list' %}" class="btn btn-primary">Friend list</a>
                    <a href="{% url 'SocialMedia:like_list' %}" class="btn btn-primary">Like list</a>
                    <a href="{% url 'SocialMedia:block_list' %}" class="btn btn-danger">Block list</a>
                </div>
            </div>
        </div>

        <div class="user_groups">
            <h3>Nh√≥m c·ªßa t√¥i:</h3>
            {% if groups %}
                <ul>
                    {% for group in groups %}
                        <li>
                            <a href="{% url 'SocialMedia:group_detail' group.pk %}">{{ group.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Ch∆∞a c√≥ nh√≥m n√†o.</p>
            {% endif %}
        </div>

        <div class="user_pages">
            {% if pages %}
                <h3>Trang:</h3>
                <ul>
                    {% for page in pages %}
                        <li>
                            <a href="{% url 'SocialMedia:page_detail' page.id %}">{{ page.title }}</a>
                            {% if page.posts.all %}
                                <ul>
                                    {% for post in page.posts.all %}
                                        <li>
                                            <a style="color: black;" href="{% url 'SocialMedia:post_detail' post.id %}">T√™n b√†i vi·∫øt: {{ post.title }} - Ng√†y ƒëƒÉng: {{ post.created_at }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <li>Kh√¥ng c√≥ b√†i vi·∫øt n√†o.
                                    <a href="{% url 'SocialMedia:manage_post' page.id %}">Th√™m b√†i vi·∫øt</a>
                                </li>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Kh√¥ng c√≥ trang n√†o ƒë∆∞·ª£c t·∫°o.</p>
            {% endif %}
            <div class="add_page">
                <a href="{% url 'SocialMedia:manage_page' %}" class="btn btn-success">T·∫°o Trang M·ªõi</a>
            </div>
        </div>

        <div class="shared_posts">
            <h3>B√†i Vi·∫øt ƒê√£ Chia S·∫ª</h3>
            {% if shared_posts %}
                <ul>
                    {% for share in shared_posts %}
                        <li>
                            <a href="{% url 'SocialMedia:share_post' share.id share.post.id %}">
                                {{ share.post.title }} - Chia s·∫ª b·ªüi {{ share.user.username }} - Ng√†y chia s·∫ª: {{ share.created_at|date:"F j, Y" }}
                            </a>
                            {% if share.user == user %}
                                <a href="{% url 'SocialMedia:share_post' share.id share.post.id %}" style="background: none; border: none; color: orange; cursor: pointer;">‚úèÔ∏è</a>
                                <form action="{% url 'SocialMedia:share_post' share.id share.post.id %}" method="POST" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" name="delete" style="background: none; border: none; color: red; cursor: pointer;" onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i chia s·∫ª n√†y kh√¥ng?');">
                                        üóëÔ∏è
                                    </button>
                                </form>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Kh√¥ng c√≥ b√†i vi·∫øt n√†o ƒë∆∞·ª£c chia s·∫ª.</p>
            {% endif %}
        </div>

        <!-- Ph·∫ßn N·ªôi Dung Tr·∫£ Ph√≠ -->
        <div class="paid-content-section">
            <h3>N·ªôi Dung Tr·∫£ Ph√≠</h3>
            {% if paid_contents %}
                <ul>
                    {% for content in paid_contents %}
                        <li>
                            <a href="{% url 'SocialMedia:purchase_content' content.id %}">
                                {{ content.title }} - Gi√°: {{ content.price }} VNƒê
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Kh√¥ng c√≥ n·ªôi dung n√†o ƒë·ªÉ hi·ªÉn th·ªã.</p>
            {% endif %}
            
            {% if profile.user == user %}
                <a href="{% url 'SocialMedia:create_paid_content' %}" class="btn btn-primary">Th√™m n·ªôi dung tr·∫£ ph√≠</a>
            {% endif %}
        </div>
</div>
    {% endif %}
    <div class="user_posts">
        <h3>B√†i ƒëƒÉng c·ªßa t√¥i:</h3>
        {% if profile.user.personal_posts.all %}
            <ul>
                {% for post in profile.user.personal_posts.all %}
                    <li>
                        <h5>{{ post.title }}</h5>
                        <p>{{ post.content }}</p>
                        <small>{{ post.created_at|timesince }} ago</small>
                        {% if post.image %}
                            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid">
                        {% else %}
                            <p>No image available for this post.</p>
                        {% endif %}
                        <!-- N√∫t Ch·ªânh s·ª≠a v√† X√≥a ch·ªâ hi·ªÉn th·ªã cho ng∆∞·ªùi t·∫°o b√†i vi·∫øt -->
                        {% if post.user == request.user %}
                            <a href="{% url 'SocialMedia:edit_personal_post' pk=post.pk %}" class="btn btn-warning">Ch·ªânh s·ª≠a</a>
                            <a href="{% url 'SocialMedia:delete_personal_post' pk=post.pk %}" class="btn btn-danger">X√≥a</a>
                        {% endif %}               

                        <!-- Hi·ªÉn th·ªã b√¨nh lu·∫≠n -->
                        <div class="comments">
                            <h4>B√¨nh lu·∫≠n ({{ post.comments.count }})</h4>
                            {% if post.comments.all %}
                                <ul>
                                    {% for comment in post.comments.all %}
                                        <li>
                                            <strong>{{ comment.author.username }}:</strong> {{ comment.content }}
                                            <small>{{ comment.created_at }}</small>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>   
                            {% endif %}
                        </div>
                
                        <!-- Form b√¨nh lu·∫≠n -->
                        <form method="POST">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <input type="hidden" name="post_id" value="{{ post.id }}">
                            <button type="submit" class="btn btn-primary">Th√™m b√¨nh lu·∫≠n</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Ch∆∞a c√≥ b√†i ƒëƒÉng n√†o.</p>
        {% endif %}
        <a href="{% url 'SocialMedia:create_personal_post' %}" class="btn btn-primary">ƒêƒÉng b√†i m·ªõi</a>
    </div>
</div>
{% endblock %}